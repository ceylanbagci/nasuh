{% extends "home/base.html" %}
{% load humanize %}

{% block head %}
{{form.media}}
{% endblock %}

{% block content %}
<!--begin::Entry-->
<div class="d-flex flex-column-fluid">
<!--begin::Container-->
<div class="container-fluid">
<!--begin::Card-->
<div class="card card-custom gutter-b">
<div class="card-body">
	<div class="d-flex">
		<!--begin: Pic-->
		<div class="flex-shrink-0 mr-7 mt-lg-0 mt-3">
			<div class="symbol symbol-50 symbol-lg-120">
				<img alt="Pic" src="/static/assets/media/project-logos/nasuh_logo.png" />
			</div>
			<div class="symbol symbol-50 symbol-lg-120 symbol-primary d-none">
				<span class="font-size-h3 symbol-label font-weight-boldest">JM</span>
			</div>
		</div>
		<!--end: Pic-->
		<!--begin: Info-->
		<div class="flex-grow-1">
			<!--begin: Title-->
			<div class="d-flex align-items-center justify-content-between flex-wrap">
				<div class="mr-3">
					<!--begin::Name-->
					<a href="#" class="d-flex align-items-center text-dark text-hover-primary font-size-h5 font-weight-bold mr-3">{{case.title}}
					<i class="flaticon2-correct text-success icon-md ml-2"></i></a>
					<!--end::Name-->
					<!--begin::Contacts-->
					<div class="d-flex flex-wrap my-2">
						<a href="#" class="text-muted text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
						<span class="svg-icon svg-icon-md svg-icon-gray-500 mr-1">
							<!--begin::Svg Icon | path:assets/media/svg/icons/General/Lock.svg-->
							<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
								<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
									<mask fill="white">
										<use xlink:href="#path-1" />
									</mask>
									<g />
									<path d="M7,10 L7,8 C7,5.23857625 9.23857625,3 12,3 C14.7614237,3 17,5.23857625 17,8 L17,10 L18,10 C19.1045695,10 20,10.8954305 20,12 L20,18 C20,19.1045695 19.1045695,20 18,20 L6,20 C4.8954305,20 4,19.1045695 4,18 L4,12 C4,10.8954305 4.8954305,10 6,10 L7,10 Z M12,5 C10.3431458,5 9,6.34314575 9,8 L9,10 L15,10 L15,8 C15,6.34314575 13.6568542,5 12,5 Z" fill="#000000" />
								</g>
							</svg>
							<!--end::Svg Icon-->
						</span>{{case.case_id}}</a>
						<a href="#" class="text-muted text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
						<span class="svg-icon svg-icon-muted svg-icon-2x"><!--begin::Svg Icon | path:/var/www/preview.keenthemes.com/metronic/releases/2021-02-01-052524/theme/html/demo1/dist/../src/media/svg/icons/Map/Marker2.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <rect x="0" y="0" width="24" height="24"/>
        <path d="M9.82829464,16.6565893 C7.02541569,15.7427556 5,13.1079084 5,10 C5,6.13400675 8.13400675,3 12,3 C15.8659932,3 19,6.13400675 19,10 C19,13.1079084 16.9745843,15.7427556 14.1717054,16.6565893 L12,21 L9.82829464,16.6565893 Z M12,12 C13.1045695,12 14,11.1045695 14,10 C14,8.8954305 13.1045695,8 12,8 C10.8954305,8 10,8.8954305 10,10 C10,11.1045695 10.8954305,12 12,12 Z" fill="#000000"/>
    </g>
</svg><!--end::Svg Icon--></span>{{case.city}}/{{case.district}}</a>
					</div>
					<!--end::Contacts-->
				</div>
				<div class="my-lg-0 my-1">
					<a href="/report/{{case.slug}}/get_case_report" class="btn btn-sm btn-light-success font-weight-bolder text-uppercase mr-3">Rapor Al</a>
					<a href="/case/{{case.slug}}/update" class="btn btn-sm btn-info font-weight-bolder text-uppercase mr-3">Düzenle</a>
					<a href="/case/{{case.slug}}/None/determine_share" class="btn btn-sm btn-primary font-weight-bolder text-uppercase mr-3">Hisse  Oluştur</a>
					<a href="/case/{{case.slug}}/delete" class="btn btn-sm btn-danger font-weight-bolder text-uppercase btn-delete-confirmation">Sil</a>
				</div>
			</div>
			<!--end: Title-->
			<!--begin: Content-->
			<div class="d-flex align-items-center flex-wrap justify-content-between">
				<div class="flex-grow-1 font-weight-bold text-dark-50 py-5 py-lg-2 mr-5">
					{{case.description}}
				<div class="d-flex flex-wrap align-items-center py-2">
					<div class="d-flex align-items-center mr-10">
						<div class="mr-6">
							<div class="font-weight-bold mb-2">Tarih</div>
							<span class="btn btn-sm btn-text btn-light-primary text-uppercase font-weight-bold">{{case.date}}</span>
						</div>
						<div class="mr-6">
							<div class="font-weight-bold mb-2">Durum</div>
							<span class="btn btn-sm btn-text text-uppercase font-weight-bold" id="btn-styled" data-id="{{case.status}}">{{case.get_status_display}}</span>
						</div>
						<div class="mr-6">
							<div class="font-weight-bold mb-2">Müvekkil</div>
							{%for client in case.client.all%}
								<span class="btn btn-sm btn-light-danger btn-text text-uppercase font-weight-bold">{{client.full_name}}</span>
							{%endfor%}
						</div>
						<div class="mr-6">
							<div class="font-weight-bold mb-2">Ortak</div>
							{%if case.partnerships.all%}
								{%for partnership in case.partnerships.all%}
									<span class="btn btn-sm btn-light-secondary btn-text text-uppercase font-weight-bold text-dark">{{partnership.partner.full_name}} %{{partnership.share}}</span>
								{%endfor%}
							{%else%}
							{%for partner in case.partner.all%}
								<span class="btn btn-sm btn-light-secondary btn-text text-uppercase font-weight-bold text-dark">{{partner.full_name}}</span>
							{%endfor%}
							{%endif%}
						</div>

					</div>

				</div>
				</div>
			</div>
			<!--end: Content-->
		</div>
		<!--end: Info-->
	</div>
	<div class="separator separator-solid my-7"></div>
	<!--begin: Items-->
	<div class="d-flex align-items-center justify-content-end flex-wrap" style="margin-left:145px;">
		<!--begin: Item-->
		<div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
			<span class="mr-4">
				<i class="flaticon-piggy-bank icon-2x text-muted font-weight-bold"></i>
			</span>
			<div class="d-flex flex-column text-dark-75">
				<span class="font-weight-bolder font-size-sm">Gelir</span>
				<span class="font-weight-bolder font-size-h5">
				<span class="text-dark-50 font-weight-bold"></span>{{case.get_stats.total_income.sum|intcomma}} ₺</span>
			</div>
		</div>
		<!--end: Item-->
		<!--begin: Item-->
		<div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
			<span class="mr-4">
				<i class="flaticon-confetti icon-2x text-muted font-weight-bold"></i>
			</span>
			<div class="d-flex flex-column text-dark-75">
				<span class="font-weight-bolder font-size-sm">Gider</span>
				<span class="font-weight-bolder font-size-h5">
				<span class="text-dark-50 font-weight-bold"></span>{{case.get_stats.total_spent.sum|intcomma}} ₺</span>
			</div>
		</div>
		<!--end: Item-->
		<!--begin: Item-->
		<div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
			<span class="mr-4">
				<i class="flaticon-pie-chart icon-2x text-muted font-weight-bold"></i>
			</span>
			<div class="d-flex flex-column text-dark-75">
				<span class="font-weight-bolder font-size-sm">Kâr</span>
				<span class="font-weight-bolder font-size-h5">
				<span class="text-dark-50 font-weight-bold"></span>{{case.get_stats.get_difference|intcomma}} ₺</span>
			</div>
		</div>
		<!--end: Item-->
		<!--begin: Item-->
		<div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
			<span class="mr-4">
				<i class="flaticon-file-2 icon-2x text-muted font-weight-bold"></i>
			</span>
			<div class="d-flex flex-column flex-lg-fill">
				<span class="text-dark-75 font-weight-bolder font-size-sm">Toplam Hesap  Hareketi</span>
				<a href="#" class="text-primary font-weight-bolder">{{case.get_stats.total}}</a>
			</div>
		</div>
		<!--end: Item-->


	</div>
	<!--begin: Items-->
</div>
</div>
<!--end::Card-->
<!--begin::Row-->
<div class="row">
<div class="col-lg-8">
	<!--begin::Advance Table Widget 3-->
	<div class="card card-custom card-stretch gutter-b">
		<!--begin::Header-->
		<div class="card-header border-0 py-5">
			<h3 class="card-title align-items-start flex-column">
				<span class="card-label font-weight-bolder text-dark">Dosya Hesap Hareketleri</span>
				<span class="text-muted mt-3 font-weight-bold font-size-sm">Toplam {{case.get_stats.total}}</span>
			</h3>
			<div class="card-toolbar">
				<a href="/transactions/{{case.slug}}/case_expense_one" class="btn btn-success font-weight-bolder font-size-sm">
				<span class="svg-icon svg-icon-white svg-icon-2x"><!--begin::Svg Icon | path:/var/www/preview.keenthemes.com/metronic/releases/2021-02-01-052524/theme/html/demo1/dist/../src/media/svg/icons/Shopping/Money.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <rect x="0" y="0" width="24" height="24"/>
        <path d="M2,6 L21,6 C21.5522847,6 22,6.44771525 22,7 L22,17 C22,17.5522847 21.5522847,18 21,18 L2,18 C1.44771525,18 1,17.5522847 1,17 L1,7 C1,6.44771525 1.44771525,6 2,6 Z M11.5,16 C13.709139,16 15.5,14.209139 15.5,12 C15.5,9.790861 13.709139,8 11.5,8 C9.290861,8 7.5,9.790861 7.5,12 C7.5,14.209139 9.290861,16 11.5,16 Z" fill="#000000" opacity="0.3" transform="translate(11.500000, 12.000000) rotate(-345.000000) translate(-11.500000, -12.000000) "/>
        <path d="M2,6 L21,6 C21.5522847,6 22,6.44771525 22,7 L22,17 C22,17.5522847 21.5522847,18 21,18 L2,18 C1.44771525,18 1,17.5522847 1,17 L1,7 C1,6.44771525 1.44771525,6 2,6 Z M11.5,16 C13.709139,16 15.5,14.209139 15.5,12 C15.5,9.790861 13.709139,8 11.5,8 C9.290861,8 7.5,9.790861 7.5,12 C7.5,14.209139 9.290861,16 11.5,16 Z M11.5,14 C12.6045695,14 13.5,13.1045695 13.5,12 C13.5,10.8954305 12.6045695,10 11.5,10 C10.3954305,10 9.5,10.8954305 9.5,12 C9.5,13.1045695 10.3954305,14 11.5,14 Z" fill="#000000"/>
    </g>
</svg><!--end::Svg Icon--></span>Yeni Hesap Hareketi Oluştur</a>
			</div>
		</div>
		<!--end::Header-->
		<!--begin::Body-->
		<div class="card-body pt-0 pb-3">
			<!--begin::Table-->
			<div class="table-responsive">
				<table class="table table-head-custom table-head-bg table-borderless table-vertical-center">
					<thead>
						<tr class="text-uppercase">
							<th class="pl-7">
								<span>Gelir Gider Türü</span>
							</th>
							<th >Gelir</th>
							<th >Gider</th>
							<th >Tarih</th>
							<th >Düzenle</th>
						</tr>
					</thead>
					<tbody>
						{%for trans in results%}
						<tr>
							<td>
								<span class="text-dark-75 font-weight-bolder d-block font-size-lg">{{trans.expense.title}}</span>
								<span class="text-muted font-weight-bold">{{trans.description}}</span>
							</td>
							<td>
								{%if trans.type == 1%}
								<span class="label label-lg label-light-success label-inline font-weight-bolder">{{trans.amount|intcomma}}₺</span>
								{%endif%}
							</td>
							<td>
								{%if trans.type == 2%}
								<span class="label label-lg label-light-danger label-inline font-weight-bolder">{{trans.amount|intcomma}}₺</span>
								{%endif%}
							</td>
							<td>
								<span class="text-dark-75 font-weight-bolder d-block font-size-lg">{{trans.date}}</span>
							</td>


							<td class="text-right pr-0">
								<a href="/transactions/{{trans.id}}/delete" class="btn btn-icon btn-light btn-hover-primary btn-sm mr-3 btn-delete-confirmation">
									<span class="svg-icon svg-icon-primary svg-icon"><!--begin::Svg Icon | path:/var/www/preview.keenthemes.com/metronic/releases/2021-02-01-052524/theme/html/demo9/dist/../src/media/svg/icons/Home/Trash.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
										<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
											<rect x="0" y="0" width="24" height="24"/>
											<path d="M6,8 L18,8 L17.106535,19.6150447 C17.04642,20.3965405 16.3947578,21 15.6109533,21 L8.38904671,21 C7.60524225,21 6.95358004,20.3965405 6.89346498,19.6150447 L6,8 Z M8,10 L8.45438229,14.0894406 L15.5517885,14.0339036 L16,10 L8,10 Z" fill="#000000" fill-rule="nonzero"/>
											<path d="M14,4.5 L14,3.5 C14,3.22385763 13.7761424,3 13.5,3 L10.5,3 C10.2238576,3 10,3.22385763 10,3.5 L10,4.5 L5.5,4.5 C5.22385763,4.5 5,4.72385763 5,5 L5,5.5 C5,5.77614237 5.22385763,6 5.5,6 L18.5,6 C18.7761424,6 19,5.77614237 19,5.5 L19,5 C19,4.72385763 18.7761424,4.5 18.5,4.5 L14,4.5 Z" fill="#000000" opacity="0.3"/>
										</g>
									</svg><!--end::Svg Icon--></span>
								</a>

							</td>
						</tr>
						{%endfor%}
						<div class="separator separator-solid my-7"></div>
						<tr>
							<td>
								<span class="text-dark-75 font-weight-bolder d-block font-size-lg">Toplam</span>
								<span class="text-muted font-weight-bold"></span>
							</td>
							<td>
								<span class="label label-lg label-light-success label-inline">{{case.get_stats.total_income.sum|intcomma}} ₺</span>
							</td>
							<td>
								<span class="label label-lg label-light-danger  label-inline">{{case.get_stats.total_spent.sum|intcomma}} ₺</span>
								<span class="text-muted font-weight-bold"></span>
							</td>
							<td>
								<span class="text-dark-75 font-weight-bolder d-block font-size-lg"></span>
								<span class="text-muted font-weight-bold"></span>
							</td>

							<td class="text-right pr-0">

							</td>
						</tr>
					</tbody>
				</table>
				{% if results.has_other_pages %}
                <div class="row">
                  <div class="col-12">
                    <ul class="pagination justify-content-center">
                        <li class="page-item"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="?page=1">
                            <i class="ki ki-bold-double-arrow-back icon-xs"></i>
                        </a></li>
                      {% if results.has_previous %}
                        <li class="page-item"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="?page={{ results.previous_page_number }}">
                            <i class="ki ki-bold-arrow-back icon-xs"></i>
                        </a></li>
                      {% else %}
                        <li class="page-item disabled"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="#">
                            <i class="ki ki-bold-arrow-back icon-xs"></i>
                        </a></li>
                      {% endif %}

                      {% if results.number|add:'-4' > 1 %}
                        <li><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="?page={{ results.number|add:'-10' }}">&hellip;</a></li>
                      {% endif %}

                      {% for i in results.paginator.page_range %}
                        {% if results.number == i %}
                          <li class="page-item disabled"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1 active" href="#">{{ i }}</a></li>
                        {% elif i > results.number|add:'-3' and i < results.number|add:'3' %}
                          <li class="page-item"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="?page={{ i }}">{{ i }}</a></li>
                        {% endif %}
                      {% endfor %}

                      {% if results.paginator.num_pages > results.number|add:'2' %}
                          <li><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="?page={{ results.number|add:'10' }}">&hellip;</a></li>
                      {% endif %}

                      {% if results.has_next %}
                        <li class="page-item"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="?page={{ results.next_page_number }}">
                            <i class="ki ki-bold-arrow-next icon-xs"></i>
                        </a></li>
                      {% else %}
                        <li class="page-item disabled"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="#">
                            <i class="ki ki-bold-arrow-next icon-xs"></i>
                        </a></li>
                      {% endif %}
                        <li class="page-item"><a class="btn btn-icon btn-sm border-0 btn-hover-primary mr-2 my-1" href="?page={{ results.paginator.num_pages }}">
                            <i class="ki ki-bold-double-arrow-next icon-xs"></i>
                        </a></li>
                    </ul>
                  </div>
                </div>
                {% endif %}
			</div>
			<!--end::Table-->
		</div>
		<!--end::Body-->
	</div>
	<!--end::Advance Table Widget 3-->
</div>
<div class="col-lg-4">
	<!--begin::Charts Widget 1-->
	<div class="card card-custom card-stretch gutter-b">
		<!--begin::Header-->
		<div class="card-header h-auto border-0">
			<!--begin::Title-->
			<div class="card-title py-5">
				<h3 class="card-label">
					<span class="d-block text-dark font-weight-bolder">Son 7 Hesap Hareketi</span>
					<span class="d-block text-muted mt-2 font-size-sm">Gelir Gider Durumu</span>
				</h3>
			</div>
			<!--end::Title-->

		</div>
		<!--end::Header-->
		<!--begin::Body-->
		<div class="card-body">
			<!--begin::Chart-->
			<div id="kt_charts_widget_1_chart_case" data-slug="{{case.slug}}"></div>
			<!--end::Chart-->
		</div>
		<!--end::Body-->
	</div>
	<!--end::Charts Widget 1-->
</div>
</div>
<!--end::Row-->
</div>
<!--end::Container-->
</div>
<!--end::Entry-->


{% endblock %}

{% block script %}
<script src="/static/assets/js/view_case.js"></script>
<script src="/static/assets/js/init_chart/init_charts_case.js"></script>
{% endblock %}